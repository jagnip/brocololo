generator client {
  provider = "prisma-client"
  output   = "../src/generated"
}

datasource db {
  provider = "postgresql"
}

model Category {
  id      String   @id @default(cuid())
  name    String   @unique
  slug    String   @unique
  recipes Recipe[] @relation("category_recipes")

  @@map("categories")
}

model Recipe {
  id           String     @id @default(cuid())
  name         String     @unique
  slug         String     @unique
  imageUrl     String?     @map("image_url")
  instructions String[]
  handsOnTime  Int        @map("hands_on_time")
  notes        String[] 
  servings     Int
  categories   Category[] @relation("category_recipes")
  ingredients RecipeIngredient[]

  @@map("recipes")
}


model Ingredient {
  id            String   @id @default(cuid())
  name          String   @unique
  slug          String   @unique
  supermarketUrl String? @map("supermarket_url")
  calories       Float
  proteins       Float
  fats           Float
  carbs          Float
  recipes RecipeIngredient[]
  unitConversions IngredientUnit[]
  
  @@map("ingredients")
}

model Unit {
  id          String   @id @default(cuid())
  name        String   @unique
  
  ingredientUnits IngredientUnit[]
  recipeIngredients RecipeIngredient[]
  
  @@map("units")
}

model IngredientUnit {
  ingredientId  String @map("ingredient_id")
  unitId        String @map("unit_id")
  gramsPerUnit  Float @map("grams_per_unit")
  
  ingredient    Ingredient @relation(fields: [ingredientId], references: [id], onDelete: Cascade)
  unit          Unit      @relation(fields: [unitId], references: [id], onDelete: Restrict)
  
  @@id([ingredientId, unitId])
  @@map("ingredient_units")
}

model RecipeIngredient {
  id          String   @id @default(cuid())
  recipeId    String @map("recipe_id")
  ingredientId String @map("ingredient_id")
  amount      Float? 
  unitId      String @map("unit_id")
  excludeFromNutrition Boolean @default(false) @map("exclude_from_nutrition")
  additionalInfo String? @map("additional_info")

  recipe      Recipe   @relation(fields: [recipeId], references: [id], onDelete: Cascade)
  ingredient  Ingredient @relation(fields: [ingredientId], references: [id], onDelete: Restrict)
  unit        Unit     @relation(fields: [unitId], references: [id], onDelete: Restrict)

  @@map("recipe_ingredients")
}
